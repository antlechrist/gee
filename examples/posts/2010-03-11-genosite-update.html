<!DOCTYPE html>
<html lang="en">
<head>
<title>posts.antlechrist.org/2010-03-11-genosite-update</title>
<meta charset="utf-8" />
<meta name="viewport" content="user-scalable=no, width=device-width" />
<link href="/favicon.png" rel="shortcut icon" />
<link href="/mobile.css" rel="stylesheet"
      media="only screen and (max-width: 480px)" />
<link href="/style.css" rel="stylesheet"
      media="screen and (min-width: 481px)" />
<!--[if IE]>
<link href="/ie.css" rel="stylesheet" media="all" />
<![endif]-->
<link href="/atom.xml" rel="alternate" type="application/atom+xml" />
</head>
<body>
<header>
<hgroup><h1><a href="/">posts.antlechrist.org/</a></h1></hgroup>
<nav>
<ul>
<li><a href="2010-06-25-why-keep-trying.html">2010-06-25-why-keep-trying</a></li>
<li><a href="2010-06-20-shpod-podcast-client.html">2010-06-20-shpod-podcast-client</a></li>
<li><a href="2010-06-17-true-hallucinations.html">2010-06-17-true-hallucinations</a></li>
<li><a href="2010-06-11-archlinux-packages.html">2010-06-11-archlinux-packages</a></li>
<li><a href="2010-06-07-update.html">2010-06-07-update</a></li>
<li><a href="2010-05-25-science-faith-repost.html">2010-05-25-science-faith-repost</a></li>
<li><a href="2010-05-23-rotation.html">2010-05-23-rotation</a></li>
<li><a href="2010-05-21-infrastructures-repost.html">2010-05-21-infrastructures-repost</a></li>
<li><a href="2010-05-14-nile-tour.html">2010-05-14-nile-tour</a></li>
<li><a href="2010-05-12-canada.html">2010-05-12-canada</a></li>
<li class='current'><a href="2010-03-11-genosite-update.html">2010-03-11-genosite-update</a></li>
<li><a href="2010-03-10-animal-rights-new-man-haters-locke.html">2010-03-10-animal-rights-new-man-haters-locke</a></li>
<li><a href="2010-02-24-genosite-quark-discount-rsync.html">2010-02-24-genosite-quark-discount-rsync</a></li>
<li><a href="2010-02-20-tascam-us-428-linux.html">2010-02-20-tascam-us-428-linux</a></li>
<li><a href="2010-02-17-bsdtar-compression-stats.html">2010-02-17-bsdtar-compression-stats</a></li>
<li><a href="2010-02-04-screenshots.html">2010-02-04-screenshots</a></li>
<li><a href="2010-02-03-bookmarking-uzbl.html">2010-02-03-bookmarking-uzbl</a></li>
<li><a href="2010-02-02-bookmarking-surf-redux.html">2010-02-02-bookmarking-surf-redux</a></li>
<li><a href="2010-02-01-bookmarking-surf.html">2010-02-01-bookmarking-surf</a></li>
<li><a href="2010-01-31-webcast-berkeley-edu.html">2010-01-31-webcast-berkeley-edu</a></li>
<li><a href="2010-01-30-rotation.html">2010-01-30-rotation</a></li>
</ul>
</nav>
</header>
<article>
<h1>GENOSITE UPDATE</h1>

<p>I&rsquo;ve made some modification to the scripts. Check it out.</p>

<h2>genosite.sh</h2>

<pre><code>#!/bin/sh

EXT=md
FMT=markdown
LC_ALL=en_US.UTF-8
PATH=/bin:/usr/bin
PREFIX=/
URL=andrew.antlechrist.org
export LC_ALL PATH

menu() {
    for i in `ls -F $1 | grep -v index.$EXT | sort`
    do
        case $i in
        *.$EXT)
            base=`echo $i | sed "s/.\$EXT$//"`
            cleanbase=`echo $base | sed 's/_/ /g'`
            if test "x$base" = "x$2"
            then
                echo "&lt;li class='current'&gt;&lt;a href=\"$base.html\"&gt;$cleanbase&lt;/a&gt;&lt;/li&gt;"
            else
                echo "&lt;li&gt;&lt;a href=\"$base.html\"&gt;$cleanbase&lt;/a&gt;&lt;/li&gt;"
            fi
            cur=1
            ;;
        */)
            echo "&lt;li&gt;&lt;a href=\"$i\"&gt;$i&lt;/a&gt;&lt;/li&gt;"
            ;;
        esac
    done
    cat &lt;&lt;END
&lt;/ul&gt;
&lt;/div&gt;
END
}

page() {
    mtime=`ls -l $1$2.$EXT | awk '{ print $6" " $7" at " $8 }'`
    title="$URL`echo $4 | sed 's/.html//'`"
    cat &lt;&lt;END
&lt;!doctype html&gt;
&lt;head&gt;
&lt;title&gt;$title&lt;/title&gt;
&lt;meta http-equiv="content-type" content="text/html; charset=utf-8" /&gt;
&lt;link href="/favicon.png" rel="icon" type="image/png" /&gt;
&lt;link href="/style.css" rel="stylesheet" type="text/css" /&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id="container"&gt;
&lt;div class="midHeader"&gt;
&lt;div class="headerTitle"&gt;$3&lt;/a&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id="menu"&gt;
&lt;ul&gt;
END
    menu $1 $2
cat &lt;&lt;END
&lt;div id="main-copy"&gt;
END
    cat $1$2.$EXT | tr -d '\r' | $FMT
    cat &lt;&lt;END
&lt;/div&gt;
&lt;div id="footer"&gt;
&lt;div class="left"&gt;
Powered by &lt;a href="http://hg.suckless.org/genosite"&gt;genosite&lt;/a&gt;,
&lt;a href="http://www.pell.portland.or.us/~orc/Code/discount/"&gt;discount&lt;/a&gt;,
and &lt;a href="http://www.vim.org/"&gt;vim&lt;/a&gt;&lt;br /&gt;
&lt;a href="$2.$EXT"&gt;Page source&lt;/a&gt;
&lt;/div&gt;
&lt;div class="right"&gt;
Last modified: $mtime&lt;br /&gt;
&lt;a href="/LICENSE"&gt;Copyright 2009-2010 Andrew Antle&lt;/a&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
END
}

process() {
    for i in `ls -F $1`
    do
        case $i in
        *.$EXT)
            echo processing $1$i
            base=`echo $i | sed "s/.\$EXT$//"`
            if test x$base = xindex
            then
                title=$3
            else
                title=$3$base.html
            fi
            page "$1" "$base" "$2" "$title" &gt; "$1$base.html"
            ;;
        */)
            process "$1$i" "$2&lt;/a&gt; &lt;a href=\"$PREFIX`echo $1 | \
            sed 's/.\///'`$i\"&gt;$i" $3$i
            ;;
        *)
            ;;
        esac
    done
}

if test $1
then
    cd $1
fi

find . -type l | xargs rm -f

process "./" "&lt;a href=\"/\"&gt;$URL/" /
</code></pre>

<h2>genosync.sh</h2>

<pre><code>#!/bin/sh

# file:   ~/bin/genosync.sh
# author: Andrew Antle - http://antlechrist.org/
# date:   2010-03-11

RSYNC=/usr/bin/rsync
SSH=/usr/bin/ssh
PORT=portnumber
RUSER=username
RHOST=example.org
RPATH=/remotepath/
LPATH=/localpath/

do_pull() {
    $RSYNC -avz --delete -e "$SSH -p $PORT" $RUSER@$RHOST:$RPATH $LPATH
}

do_push() {
    $RSYNC -avz --delete -e "$SSH -p $PORT" $LPATH $RUSER@$RHOST:$RPATH
}

case "$1" in
    -l | --pull)
        do_pull
        if [ $? -gt 0 ]; then
            echo FAILED
            exit 1
        else
            echo SUCCESS
        fi
        ;;
    -s | --push)
        do_push
        if [ $? -gt 0 ]; then
            echo FAILED
            exit 1
        else
            echo SUCCESS
        fi
        ;;
    *)
        echo "usage: `basename $0` {-l, --pull|-s, --push}"
esac

exit 0
</code></pre>

<p>Thanks to <a href="http://garbe.us/">Anselm</a> for this excellent script.
My modifications are released under the same
<a href="http://hg.suckless.org/genosite/raw-file/tip/LICENSE">license</a>
as genosite itself. Feel free to use them as you see fit.</p>
</article>
<footer>
<section class="l">
Powered by <a href="http://github.com/antlechrist/gee">gee</a><br />
<a href="2010-03-11-genosite-update.md">Page source</a> |
<a href="http://antlechrist.org/">Main</a>
</section>
<section class="r">
Last modified: 2010-07-05 at 19:36<br />
<a href="/LICENSE">Â© 2009-2010</a>
<a href="mailto:andrew@antlechrist.org">Andrew Antle</a>
</section>
</footer>
</body>
</html>
